# HmDebugMonitor プロジェクトの問題点

このドキュメントは、`HmDebugMonitor` プロジェクトの現状分析と、確認された主な問題点をまとめたものです。

## 1. ソースコードの文字エンコーディング問題

プロジェクトのソースコード（`.cpp`, `.h` ファイル）は、**Shift_JIS** で保存されています。
これにより、現代の主要な開発環境であるUTF-8環境でファイルを開くと、コメントやコード内の日本語文字列がすべて文字化けしてしまいます。

- **問題点:**
    - コードの可読性が著しく低い。
    - メンテナンスや機能追加が非常に困難。
    - 新しい開発者がコードを理解する上で大きな障壁となる。

- **推奨される対策:**
    - すべてのソースファイルをUTF-8エンコーディングに変換する。

## 2. ビルド環境の旧式化とドキュメント不足

本プロジェクトは **Visual Studio 2017** をターゲットにしていると推測されますが、これは古い開発環境です。
また、ビルド手順や必要なライブラリのセットアップ方法を記したドキュメントが一切存在しません。

- **問題点:**
    - 新しい開発者がビルド環境を構築することが困難。
    - `oniguruma` ライブラリが静的ライブラリとして同梱されていますが、そのビルドが成功しているかどうかが不明確です (`unsuccessfulbuild` ファイルの存在）。
    - 現代のC++標準やセキュリティ機能を活用できていない。

- **推奨される対策:**
    - 最新のVisual Studio Community版でビルドできるようにプロジェクトファイルを更新する。
    - `README.md` に詳細なビルド手順を記載する。

## 3. 特定環境への強い依存

このツールは「秀丸エディタ」のデバッグ出力を監視することのみを目的としており、コード内でプロセス名 (`hidemaru.exe`) やウィンドウクラス名 (`Hidemaru32Class`) がハードコーディングされています。

- **問題点:**
    - 汎用性がなく、他のアプリケーションのデバッグには利用できない。
    - 秀丸エディタの将来のバージョンアップで仕様が変更された場合、動作しなくなる可能性がある。

- **推奨される対策:**
    - 監視対象のプロセスをユーザーが指定できるように機能を拡張する。

## 4. コードの品質と可読性の問題

コード全体に渡り、品質と可読性の面でいくつかの問題が見られます。

- **問題点:**
    - `800`, `8000` のような **マジックナンバー** が多用されており、その意味が不明確。
    - `hInst` のような **グローバル変数** が使用されており、プログラムの状態管理が複雑になっている。
    - デバッグメッセージの重複を抑制するロジックが複雑で、コメントが文字化けしているため処理の追跡が困難。

- **推奨される対策:**
    - マジックナンバーを定数として定義し、意味のある名前を付ける。
    - グローバル変数の使用を減らし、クラスのメンバ変数や関数の引数として渡すようにリファクタリングする。
    - 複雑なロジックをより小さな関数に分割し、可読性を向上させる。

## 5. 古いAPIの使用と潜在的なセキュリティリスク

コードでは、C言語スタイルの古いAPIが多用されています。

- **問題点:**
    - `sprintf` や `strncpy` のような関数は、バッファオーバーフローを引き起こす可能性があり、セキュリティ上のリスクとなります。
    - Win32 APIを直接使用しているため、コードが冗長になりがちです。

- **推奨される対策:**
    - `sprintf` をより安全な `snprintf` や `sprintf_s` に置き換える。
    - 文字列操作には `std::string` を活用し、安全性を高める。

## 6. 不親切なエラー処理

エラーが発生した場合、`MessageBox` を使用してモーダルダイアログを表示します。これはユーザーの操作を中断させるため、良いユーザー体験とは言えません。

- **問題点:**
    - ツールが自動実行されている場合などに、処理が予期せず停止してしまう。

- **推奨される対策:**
    - エラーメッセージは、メインウィンドウのステータスバーやテキストボックス内に出力するように変更する。
